<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/normalize.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <title>Forking Cocktails</title>
</head>
<body>
    <header>
        <%- include('../partials/header.ejs') %>
    </header>
    <main>
        <h2>Edit Recipe</h2>
        <form class="show-form cocktails-bg"action="/cocktails/<%= cocktail._id %>?_method=PUT" method="POST">

            <!-- Cocktail Name -->
            <label for="name">Name</label>
            <input type="text" name="name" id="cocktail-name" value="<%=cocktail.name%>">
            
            <!-- Created By: Hidden input to pass on user id while showing name -->
            <label for="createdBy">Created By</label>
            <input type="hidden" name="createdBy" value="<%=currentUser._id%>">
            <input type="text" id="createdBy" value="<%=currentUser.name%>">

            <!-- Description -->
            <label for="cocktail-description">Description</label>
            <textarea type="text" name="description" id="cocktail-description"><%=cocktail.description%></textarea>

            <!-- Extended Recipe Section -->
            <section id="cocktail-recipe">
                <!-- Header contains Label and Buttons to add/cut ingredient line -->
                <header>
                    <label for="recipeLine">Ingredients</label>
                    <nav id="recipe-actions">
                        <div class="btn people-bg text-light" id="addLine">add ingredient</div>
                        <div class="btn people-bg text-light" id="loseLine">remove ingredient</div>
                    </nav>
                </header>

                <!-- For as many lines in recipe, repeat this fieldset -->
                <% for(let i = 0; i < cocktail.recipe.length; i++){ %>
                <fieldset id="recipeLine" name="recipeLine">
                    <div id="recipe-number">
                        <!-- Measurement: Part One -->
                        <!-- A lot of code to pre-select the appropriate value -->
                        <label for="number">Number</label>
                        <select name="number" id="number">
                            <% if (cocktail.recipe[i].number === ""){ %>
                                <option value="" selected >0</option>
                            <% } else { %>
                                <option value="" >0</option>
                            <% } %>
                            <% if (cocktail.recipe[i].number === "1"){ %>
                                <option value="1" selected >1</option>
                            <% } else { %>
                                <option value="1" >1</option>
                            <% } %>
                            <% if (cocktail.recipe[i].number === "2"){ %>
                                <option value="2" selected >2</option>
                            <% } else { %>
                                <option value="2" >2</option>
                            <% } %>
                            <% if (cocktail.recipe[i].number === "3"){ %>
                                <option value="3" selected >3</option>
                            <% } else { %>
                                <option value="3" >3</option>
                            <% } %>
                            <% if (cocktail.recipe[i].number === "4"){ %>
                                <option value="4" selected >4</option>
                            <% } else { %>
                                <option value="4" >4</option>
                            <% } %>
                            <% if (cocktail.recipe[i].number === "5"){ %>
                                <option value="5" selected >5</option>
                            <% } else { %>
                                <option value="5" >5</option>
                            <% } %>
                            <% if (cocktail.recipe[i].number === "6"){ %>
                                <option value="6" selected >6</option>
                            <% } else { %>
                                <option value="6" >6</option>
                            <% } %>
                            <% if (cocktail.recipe[i].number === "7"){ %>
                                <option value="7" selected >7</option>
                            <% } else { %>
                                <option value="7" >7</option>
                            <% } %>
                            <% if (cocktail.recipe[i].number === "8"){ %>
                                <option value="8" selected >8</option>
                            <% } else { %>
                                <option value="8" >8</option>
                            <% } %>
                            <% if (cocktail.recipe[i].number === "9"){ %>
                                <option value="9" selected >9</option>
                            <% } else { %>
                                <option value="9" >9</option>
                            <% } %>
                        </select>
                    </div>
                    <!-- Measurement: Part Two -->
                    <!-- A lot of code to pre-select the appropriate value -->
                    <div id="recipe-fraction">
                        <label for="fraction">Fraction</label>
                        <select name="fraction" id="fraction">
                            <% if (cocktail.recipe[i].fraction === ""){ %>
                                <option value="" selected>0</option>
                            <% } else { %>     
                                <option value="">0</option>
                            <% } %> 
                            <% if (cocktail.recipe[i].fraction === "1/4"){ %>
                                <option value="1/4" selected>&frac14;</option>
                            <% } else { %>     
                                <option value="1/4" >&frac14;</option>
                            <% } %>    
                            <% if (cocktail.recipe[i].fraction === "1/2"){ %>
                                <option value="1/2" selected>&frac12;</option>
                            <% } else { %>     
                                <option value="1/2" >&frac12;</option>
                            <% } %>    
                            <% if (cocktail.recipe[i].fraction === "3/4"){ %>
                                <option value="3/4" selected>&frac34;</option>
                            <% } else { %>     
                                <option value="3/4" >&frac34;</option>
                            <% } %>    
                            <% if (cocktail.recipe[i].fraction === "1/8"){ %>
                                <option value="1/8" selected>&frac18;</option>
                            <% } else { %>     
                                <option value="1/8" >&frac18;</option>
                            <% } %>   
                            <% if (cocktail.recipe[i].fraction === "3/8"){ %>
                                <option value="3/8" selected>&frac38;</option>
                            <% } else { %>     
                                <option value="3/8" >&frac38;</option>
                            <% } %>    
                            <% if (cocktail.recipe[i].fraction === "5/8"){ %>
                                <option value="5/8" selected>&frac58;</option>
                            <% } else { %>     
                                <option value="5/8" >&frac58;</option>
                            <% } %> 
                            <% if (cocktail.recipe[i].fraction === "7/8"){ %>
                                <option value="7/8" selected>&frac78;</option>
                            <% } else { %>     
                                <option value="7/8" >&frac78;</option>
                            <% } %>       
                        </select>
                    </div>

                    <!-- Measurement: Part Three -->
                    <!-- A lot of code to pre-select the appropriate value -->
                    <div id="recipe-unit">
                        <label for="unit">Unit</label>
                        <select name="unit" id="unit" value="<%=cocktail.recipe[i].unit%>">
                            <% if (cocktail.recipe[i].unit === "oz"){ %>
                                <option value="oz" selected >oz</option>
                            <% } else { %>
                                <option value="oz" >oz</option>
                            <% } %> 
                            <% if (cocktail.recipe[i].unit === "dash(es)"){ %>
                                <option value="dash(es)" selected >dash(es)</option>
                            <% } else { %>
                                <option value="dash(es)" >dash(es)</option>
                            <% } %> 
                            <% if (cocktail.recipe[i].unit === "barspoon"){ %>
                                <option value="barspoon" selected >barspoon</option>
                            <% } else { %>
                                <option value="barspoon" >barspoon</option>
                            <% } %>
                            <% if (cocktail.recipe[i].unit === "drop(s)"){ %>
                                <option value="drop(s)" selected >drop(s)</option>
                            <% } else { %>
                                <option value="drop(s)" >drop(s)</option>
                            <% } %>  
                            <% if (cocktail.recipe[i].unit === "tsp"){ %>
                                <option value="tsp" selected >tsp</option>
                            <% } else { %>
                                <option value="tsp" >tsp</option>
                            <% } %> 
                            <% if (cocktail.recipe[i].unit === "tbsp"){ %>
                                <option value="tbsp" selected >tbsp</option>
                            <% } else { %>
                                <option value="tbsp" >tbsp</option>
                            <% } %> 
                            <% if (cocktail.recipe[i].unit === "ml"){ %>
                                <option value="ml" selected >ml</option>
                            <% } else { %>
                                <option value="ml" >ml</option>
                            <% } %> 
                        </select>
                    </div>

                    <!--The Ingredient BEING MEASURED -->
                    <div id="recipe-ingredient">
                        <label for="ingredient">Ingredient</label>
                        <select name=ingredient id="ingredient">
                            <% ingredients.forEach(ingredient => { %>
                                console.log(ingredient.name);
                                console.log(cocktail.recipe[i].ingredient.name);
                                <% if (ingredient.name === cocktail.recipe[i].ingredient.name) { %>
                                    <option value="<%=ingredient._id%>" selected ><%=ingredient.name%></option>
                               <% } else { %>
                                    <option value="<%=ingredient._id%>" ><%=ingredient.name%></option>
                               <% } %> 
                            <% }) %>
                        </select>
                    </div>
    
                </fieldset>
                <% } %>
            </section>

            <!-- mixing method, glass type, and garnish all on one line -->
            <fieldset id="cocktail-details">
                <!-- Mixing Method -->
                <section>
                    <label for="cocktail-method">Method</label>
                    <input class="narrow" list="methods" name="method" id="cocktail-method" value="<%=cocktail.method%>">
                    <datalist id="methods">
                        <option value="Stirred">Stirred</option>
                        <option value="Shaken">Shaken</option>
                        <option value="Built">Built</option>
                    </datalist>
                </section>
                
                <section>
                    <!-- type of glass -->
                    <label for="cocktail-glass">Glass</label>
                    <input class="narrow" list="glasses" name="glass" id="cocktail-glass" value="<%=cocktail.glass%>">
                    <datalist id="glasses">
                        <option value="Rocks">Rocks</option>
                        <option value="Coupe">Coupe</option>
                        <option value="Cocktail">Cocktail</option>
                        <option value="Collins">Collins</option>
                        <option value="Highball">Highball</option>
                        <option value="Nick and Nora">Nick and Nora</option>
                        <option value="Hurricane">Hurricane</option>
                        <option value="Tiki">Tiki</option>
                        <option value="Tiki Mug">Tiki Mug</option>
                        <option value="Mule">Mule</option>
                        <option value="Shot">Shot</option>
                    </datalist>
                </section>
              
                <section>
                    <!-- too many possibilities to offer options for garnish -->
                    <label for="garnish">Garnish</label>
                    <input class="wide" type="text" name="garnish" id="cocktail-garnish" value="<%=cocktail.garnish%>"/>
                </section> 
            </fieldset>

            <!-- Notes of Preparation -->
            <label for="cocktail-notes">Notes on Preparation</label>
            <textarea id="cocktail-notes" name="notes"><%=cocktail.notes%></textarea>
            
            <!-- Button to Submit -->
            <section class="registered-options">
                <input class="btn people-bg text-light" type="submit" value="Update Recipe" id="recipe-submit">
            </section>
            
        </form> 
    </main>
         
    <script>
        // Script to control adding/cutting of recipe lines
        // Cached Elements
        const $recipeLine = $('#recipeLine');
        const $cocktailRecipe = $('#cocktail-recipe');
        const $addLineBtn = $('#addLine'); 
        const $loseLineBtn = $('#loseLine');

        // Event Listeners
        $addLineBtn.on('click', handleAddLine);
        $loseLineBtn.on('click', handleLoseLine);
        
        // Event Handling Functions
        function handleAddLine() {
            $cocktailRecipe.append($recipeLine.clone());
        }

        function handleLoseLine() {
            $cocktailRecipe.children().last().remove();
        }

    </script>   

</body>
</html>